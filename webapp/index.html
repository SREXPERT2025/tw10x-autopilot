<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TW10X - Decentralized Raffle Protocol</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --main: #00C2FF; /* Cyber Blue */
            --bg: #020205; 
            --glass: rgba(15, 15, 25, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text: #ffffff; 
            --gray: #a0a0ff; 
            --gold: #FFD700; 
            --purple: #bd00ff;
        }
        
        /* --- BASE --- */
        body { 
            background-color: var(--bg); 
            color: var(--text); 
            font-family: 'Montserrat', sans-serif; 
            margin: 0; padding: 0; line-height: 1.6; 
            overflow-x: hidden;
            /* Cosmic Background */
            background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2072&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 5, 12, 0.7); z-index: -1; pointer-events: none; }

        a { text-decoration: none; color: inherit; transition: 0.3s; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        .container { max-width: 800px; margin: 0 auto; padding: 0 20px 60px 20px; position: relative; }
        
        /* --- HEADER --- */
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; }
        .logo { font-weight: 900; font-size: 26px; letter-spacing: 1px; color: #fff; text-shadow: 0 0 15px var(--main); }
        .header-controls { display: flex; gap: 15px; font-size: 12px; font-weight: 700; color: #fff; align-items: center; text-transform: uppercase; }
        .lang-btn { cursor: pointer; padding: 5px 10px; border: 1px solid transparent; border-radius: 20px; opacity: 0.7; }
        .lang-btn.active { border-color: var(--main); background: rgba(0, 194, 255, 0.2); opacity: 1; box-shadow: 0 0 10px rgba(0, 194, 255, 0.3); }

        .announcement { background: rgba(0, 194, 255, 0.15); color: #fff; padding: 10px; text-align: center; font-size: 12px; font-weight: 700; border-bottom: 1px solid rgba(0, 194, 255, 0.3); backdrop-filter: blur(5px); text-shadow: 0 0 5px var(--main); }

        /* --- HERO --- */
        .hero { text-align: center; padding: 40px 0 30px 0; }
        h1 { font-size: 36px; margin: 0 0 15px 0; font-weight: 900; line-height: 1.2; text-transform: uppercase; text-shadow: 0 0 25px rgba(0, 194, 255, 0.6); }
        .subtitle { color: #ccc; font-size: 13px; margin-bottom: 40px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; text-shadow: 0 2px 4px rgba(0,0,0,0.8); max-width: 600px; margin-left: auto; margin-right: auto; }

        /* --- PRIZE CARD (GLASS + GLOW) --- */
        .prize-card { 
            background: rgba(10, 15, 30, 0.6);
            backdrop-filter: blur(20px); 
            border: 2px solid var(--main); 
            border-radius: 30px; 
            padding: 40px 20px; margin: 0 auto; max-width: 420px; 
            box-shadow: 0 0 60px rgba(0, 194, 255, 0.2), inset 0 0 30px rgba(0, 194, 255, 0.1);
            position: relative; overflow: hidden;
            transform: translateZ(0); /* HW accel */
        }
        
        .prize-label { color: var(--main); text-transform: uppercase; font-size: 11px; font-weight: 800; letter-spacing: 2px; margin-bottom: 10px; text-shadow: 0 0 10px var(--main); }
        .prize-amount { font-size: 52px; font-weight: 900; line-height: 1; margin-bottom: 10px; color: #fff; text-shadow: 0 0 20px rgba(255,255,255,0.8); }
        
        /* Progress Bar */
        .progress-container { background: rgba(255,255,255,0.1); height: 6px; border-radius: 3px; margin: 25px auto 5px auto; position: relative; width: 85%; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--main), #fff); width: 0%; box-shadow: 0 0 15px var(--main); transition: width 1s ease-out; }
        .progress-text { font-size: 10px; color: #aaa; display: flex; justify-content: space-between; width: 85%; margin: 0 auto; font-weight: 700; text-transform: uppercase; }

        .timer-block { margin-top: 30px; }
        .timer { font-family: 'Courier New', monospace; font-size: 16px; color: #fff; font-weight: bold; text-shadow: 0 0 5px #fff; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 8px; display: inline-block; }
        .updated-ago { font-size: 9px; color: var(--main); text-transform: uppercase; margin-top: 5px; opacity: 0.8; }

        /* Buttons */
        .btn-primary { 
            display: block; width: 100%; max-width: 280px; margin: 30px auto 10px auto;
            background: linear-gradient(90deg, #005bea, #00c6fb); 
            color: #fff; font-weight: 900; padding: 18px 0; border-radius: 50px; font-size: 16px; 
            text-transform: uppercase; letter-spacing: 1px; text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 0 25px rgba(0, 198, 251, 0.4); border: 1px solid rgba(255,255,255,0.2);
            position: relative; overflow: hidden; transition: 0.3s;
            animation: pulse-btn 3s infinite;
        }
        .btn-primary:hover { transform: scale(1.02); box-shadow: 0 0 45px rgba(0, 198, 251, 0.6); }
        @keyframes pulse-btn { 0% { box-shadow: 0 0 0 0 rgba(0, 194, 255, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(0, 194, 255, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 194, 255, 0); } }

        .btn-secondary { color: #888; font-size: 12px; font-weight: 700; text-transform: uppercase; margin-top: 15px; display: inline-block; border-bottom: 1px dotted #555; }
        .cta-hint { font-size: 11px; color: #aaa; margin-top: 15px; max-width: 300px; margin-left: auto; margin-right: auto; line-height: 1.4; }

        /* --- STEPS --- */
        .how-works { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-top: 50px; }
        .step-card { 
            background: var(--glass); backdrop-filter: blur(10px); 
            border: 1px solid var(--glass-border); padding: 25px; border-radius: 20px; 
            text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .step-icon { font-size: 32px; margin-bottom: 10px; display: block; filter: drop-shadow(0 0 10px rgba(255,255,255,0.3)); }
        .step-text { font-size: 12px; font-weight: 700; color: #eee; text-transform: uppercase; }

        /* --- REFERRAL (GOLD) --- */
        .referral-block { 
            margin-top: 50px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.05) 0%, rgba(20, 20, 20, 0.9) 100%);
            border: 1px solid rgba(255, 215, 0, 0.4); border-radius: 20px; padding: 30px; 
            text-align: center; position: relative; overflow: hidden;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.1);
        }
        .ref-badge { position: absolute; top: 12px; right: 12px; background: var(--gold); color: #000; font-size: 10px; padding: 4px 8px; border-radius: 10px; font-weight: 900; text-transform: uppercase; }
        .ref-title { color: var(--gold); font-weight: 900; font-size: 18px; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; text-shadow: 0 0 15px rgba(255, 215, 0, 0.4); display: flex; align-items: center; justify-content: center; gap: 8px; }
        .ref-sim { font-family: monospace; background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 10px; border: 1px solid rgba(255,215,0,0.2); display: inline-block; color: #fff; margin-bottom: 20px; font-size: 12px; }
        .btn-ref { background: transparent; color: var(--gold); padding: 12px 30px; border-radius: 30px; font-size: 12px; font-weight: 900; text-transform: uppercase; border: 1px solid var(--gold); transition: 0.3s; display: inline-block; }
        .btn-ref:hover { background: var(--gold); color: #000; box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }

        /* --- SPONSOR (PURPLE) --- */
        .sponsor-block { 
            margin-top: 40px; 
            background: linear-gradient(90deg, rgba(155, 92, 255, 0.05), rgba(20, 20, 20, 0.8), rgba(155, 92, 255, 0.05));
            border: 1px solid rgba(155, 92, 255, 0.4); border-radius: 20px; padding: 25px; text-align: center; position: relative; 
            box-shadow: 0 0 30px rgba(155, 92, 255, 0.15);
        }
        .slot-badge { background: var(--purple); color: #fff; font-size: 9px; font-weight: bold; padding: 4px 10px; border-radius: 20px; text-transform: uppercase; box-shadow: 0 0 10px var(--purple); position: absolute; top: -10px; left: 50%; transform: translateX(-50%); }
        .sponsor-text { font-size: 13px; color: #eee; font-weight: 600; margin-top: 5px; }
        .sponsor-cta { color: #d0aeff; font-size: 11px; font-weight: 800; text-transform: uppercase; margin-top: 10px; display: inline-block; border-bottom: 1px solid rgba(155,92,255,0.5); }

        /* --- STATS (HUD) --- */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 50px; }
        .stat-card { 
            background: rgba(0,0,0,0.5); backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 194, 255, 0.2); 
            padding: 20px; border-radius: 16px; text-align: center; 
            transition: 0.3s; position: relative;
        }
        .stat-card:hover { border-color: var(--main); box-shadow: 0 0 20px rgba(0,194,255,0.2); transform: translateY(-3px); }
        .stat-val { font-size: 22px; font-weight: 800; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .stat-lbl { font-size: 10px; font-weight: 800; color: var(--main); text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; }
        
        details { margin-top: 8px; }
        summary { font-size: 9px; color: #777; cursor: pointer; text-transform: uppercase; font-weight: 700; transition: 0.3s; }
        summary:hover { color: #fff; }
        .details-text { font-size: 11px; color: #aaa; margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; text-align: left; }

        /* --- HISTORY --- */
        .history-section { margin-top: 80px; margin-bottom: 40px; background: rgba(0,0,0,0.4); border-radius: 20px; padding: 20px; border: 1px solid rgba(255,255,255,0.05); }
        h3 { border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; color: #fff; font-size: 13px; text-transform: uppercase; letter-spacing: 2px; margin-top: 0; }
        .history-table { width: 100%; font-size: 12px; color: #ddd; border-collapse: collapse; }
        .history-table th { text-align: left; color: var(--main); padding: 10px 5px; font-size: 10px; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }
        .history-table td { padding: 15px 5px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .tx-link { color: var(--main); font-weight: bold; }

        /* --- FOOTER --- */
        footer { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 40px; text-align: center; color: #666; font-size: 12px; }
        .socials { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .socials a { color: #fff; font-weight: 700; text-transform: uppercase; font-size: 11px; letter-spacing: 1px; }

        @media (max-width: 600px) {
            h1 { font-size: 28px; }
            .prize-amount { font-size: 48px; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .history-table th:nth-child(2), .history-table td:nth-child(2) { display: none; }
        }
    </style>
</head>
<body>

<div class="bg-overlay"></div>

<div class="announcement" id="announcement"></div>

<div class="container">
    <header>
        <div class="logo">TW10X</div>
        <div class="header-controls">
            <div id="lang-switch">
                <span class="lang-btn" onclick="setLang('en')" id="btn-en">EN</span> 
                <span class="lang-btn" onclick="setLang('ru')" id="btn-ru">RU</span>
            </div>
        </div>
    </header>

    <div class="hero">
        <h1 id="h1"></h1>
        <div class="subtitle" id="subtitle"></div>
        
        <div class="prize-card">
            <div class="prize-label" id="pool-label"></div>
            <div class="prize-amount" id="prize">0.0</div>
            
            <div class="progress-container">
                <div class="progress-bar" id="prog-bar"></div>
            </div>
            <div class="progress-text">
                <span id="prog-text"></span>
                <span>7d Cycle</span>
            </div>

            <div class="timer-block">
                <div class="timer" id="timer">--:--:--:--</div>
                <div class="updated-ago" id="updated-ago">SYNCING...</div>
            </div>

            <a href="https://t.me/tw10x_official_bot" class="btn-primary" id="btn-primary"></a>
            <div class="cta-hint" id="cta-hint"></div>
            <a href="#steps" class="btn-secondary" id="btn-secondary"></a>
        </div>
    </div>

    <!-- Steps -->
    <div class="how-works" id="steps"></div>

    <!-- Referral -->
    <div class="referral-block">
        <div class="ref-badge">GROWTH</div>
        <div class="ref-title"><span style="font-size:20px">üíé</span> <span id="ref-title"></span></div>
        <div class="ref-sim" id="ref-sim"></div>
        <br>
        <a href="https://t.me/tw10x_official_bot" class="btn-ref" id="ref-btn"></a>
    </div>

    <!-- Sponsor -->
    <div class="sponsor-block">
        <div class="slot-badge" id="slot-badge"></div>
        <div class="sponsor-text" id="sponsor-text"></div>
        <a href="https://t.me/tw10x" target="_blank" class="sponsor-cta" id="sponsor-cta"></a>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-val" id="jackpot">0</div>
            <div class="stat-lbl" id="lbl-jackpot"></div>
            <details><summary>INFO</summary><div class="details-text" id="info-jackpot"></div></details>
        </div>
        <div class="stat-card">
            <div class="stat-val" id="holder">0</div>
            <div class="stat-lbl" id="lbl-holder"></div>
            <details><summary>INFO</summary><div class="details-text" id="info-holder"></div></details>
        </div>
        <div class="stat-card">
            <div class="stat-val" id="treasury">0</div>
            <div class="stat-lbl" id="lbl-treasury"></div>
            <details><summary>INFO</summary><div class="details-text" id="info-treasury"></div></details>
        </div>
        <div class="stat-card">
            <div class="stat-val" id="dev">0</div>
            <div class="stat-lbl" id="lbl-dev"></div>
            <details><summary>INFO</summary><div class="details-text" id="info-dev"></div></details>
        </div>
    </div>

    <div class="history-section">
        <h3 id="history-title"></h3>
        <table class="history-table">
            <thead>
                <tr>
                    <th id="th-round"></th>
                    <th id="th-date"></th>
                    <th id="th-winner"></th>
                    <th id="th-prize"></th>
                    <th id="th-proof"></th>
                </tr>
            </thead>
            <tbody id="history-rows">
                <tr><td colspan="5" style="text-align:center; padding: 20px; color:#555">SYNCING ON-CHAIN...</td></tr>
            </tbody>
        </table>
    </div>

    <footer>
        <div class="socials">
            <a href="https://t.me/tw10x_official_bot" target="_blank">Mini App</a>
            <a href="https://t.me/tw10x" target="_blank">Channel</a>
            <a href="https://tonviewer.com/EQCOaDls2_jUvqMOVdShynh4tbjZTwczd1Fj0P0PZpBhgYxd" target="_blank">Contract</a>
        </div>
        <p style="opacity:0.5; margin-bottom:5px">Math-based trust. No backend manipulation.</p>
        <p style="opacity:0.3; font-size:10px;">TW10X is an experimental protocol. Verify transactions independently.</p>
        <p style="opacity:0.3; font-size:10px; margin-top:10px">&copy; 2026 TW10X Protocol.</p>
    </footer>
</div>

<script>
    // --- CONSTANTS ---
    const API_OVERVIEW = '/api/public/overview';
    const API_ROUNDS = '/api/public/rounds';
    const ROUND_DURATION = 7 * 24 * 3600; 

    // FULL CONTENT OBJECT (Restored from v3.3)
    const CONTENT = {
        en: {
            announcement: "üü¢ PROTOCOL IS LIVE. PARTICIPATION OPEN.",
            h1: "Automated On-Chain Protocol",
            subtitle: "Fixed Rules ‚Ä¢ Smart Contract ‚Ä¢ Public Verification",
            pool_label: "CURRENT ROUND POOL",
            btn_primary: "LAUNCH APP üöÄ",
            btn_secondary: "HOW IT WORKS ‚Üì",
            cta_hint: "You influence the pool size: more participants = bigger pool.",
            prog_text: "ROUND PROGRESS",
            updated: "UPDATED",
            ago: "AGO",
            steps: [
                {icon: "üì≤", text: "1. Join via Mini App"},
                {icon: "‚õìÔ∏è", text: "2. Recorded On-Chain"},
                {icon: "‚öôÔ∏è", text: "3. Auto-Calculated"}
            ],
            ref_title: "REFERRAL PARTICIPATION",
            ref_sim: "1 REFERRED PARTICIPATION = +10% REWARD",
            ref_btn: "GET MY REFERRAL LINK",
            slot_available: "SLOT AVAILABLE",
            sponsor_text: "This round has no external sponsor. Want to support the protocol?",
            sponsor_cta: "BECOME A SPONSOR",
            stats: {
                jackpot: { lbl: "JACKPOT", info: "Accumulating pool of the active round. Grows with every participation." },
                holder: { lbl: "HOLDERS", info: "Community participation pool. Used for ecosystem support." },
                treasury: { lbl: "TREASURY", info: "Protocol operational fund. Infrastructure & growth." },
                dev: { lbl: "DEV FUND", info: "Development & security fund. Audits & updates." }
            },
            history_title: "RECENT ROUNDS",
            th: ["ROUND", "DATE", "PARTICIPANT", "AMOUNT", "PROOF"],
            empty_history: "ON-CHAIN DATA WILL APPEAR HERE AFTER ROUND COMPLETION"
        },
        ru: {
            announcement: "üü¢ –†–ê–£–ù–î –ê–ö–¢–ò–í–ï–ù. –£–ß–ê–°–¢–ò–ï –û–¢–ö–†–´–¢–û.",
            h1: "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π On-Chain –ü—Ä–æ—Ç–æ–∫–æ–ª",
            subtitle: "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ ‚Ä¢ –°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚Ä¢ –ü—É–±–ª–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ—Å—Ç—å",
            pool_label: "–ü–£–õ –¢–ï–ö–£–©–ï–ì–û –†–ê–£–ù–î–ê",
            btn_primary: "–ó–ê–ü–£–°–¢–ò–¢–¨ APP üöÄ",
            btn_secondary: "–ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢ ‚Üì",
            cta_hint: "–¢—ã –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—à—å –Ω–∞ —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞. –ë–æ–ª—å—à–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ = –±–æ–ª—å—à–µ –ø—É–ª.",
            prog_text: "–ü–†–û–ì–†–ï–°–° –†–ê–£–ù–î–ê",
            updated: "–û–ë–ù–û–í–õ–ï–ù–û",
            ago: "–ù–ê–ó–ê–î",
            steps: [
                {icon: "üì≤", text: "1. –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Mini App"},
                {icon: "‚õìÔ∏è", text: "2. –ó–∞–ø–∏—Å—å On-Chain"},
                {icon: "‚öôÔ∏è", text: "3. –ê–≤—Ç–æ-—Ä–∞—Å—á–µ—Ç"}
            ],
            ref_title: "–†–ï–§–ï–†–ê–õ–¨–ù–û–ï –£–ß–ê–°–¢–ò–ï",
            ref_sim: "1 –£–ß–ê–°–¢–ò–ï –ü–û –°–°–´–õ–ö–ï = +10% –ù–ê–ì–†–ê–î–ê",
            ref_btn: "–ü–û–õ–£–ß–ò–¢–¨ –°–°–´–õ–ö–£",
            slot_available: "–°–õ–û–¢ –°–í–û–ë–û–î–ï–ù",
            sponsor_text: "–£ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞ –Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä–∞. –•–æ—Ç–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª?",
            sponsor_cta: "–°–¢–ê–¢–¨ –°–ü–û–ù–°–û–†–û–ú",
            stats: {
                jackpot: { lbl: "–î–ñ–ï–ö–ü–û–¢", info: "–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–æ–Ω–¥ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞. –†–∞—Å—Ç–µ—Ç —Å –∫–∞–∂–¥—ã–º —É—á–∞—Å—Ç–∏–µ–º." },
                holder: { lbl: "–•–û–õ–î–ï–†–´", info: "–§–æ–Ω–¥ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤." },
                treasury: { lbl: "–ö–ê–ó–ù–ê", info: "–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–æ–Ω–¥. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ." },
                dev: { lbl: "DEV FUND", info: "–§–æ–Ω–¥ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏." }
            },
            history_title: "–ü–û–°–õ–ï–î–ù–ò–ï –†–ê–£–ù–î–´",
            th: ["–†–ê–£–ù–î", "–î–ê–¢–ê", "–£–ß–ê–°–¢–ù–ò–ö", "–°–£–ú–ú–ê", "PROOF"],
            empty_history: "ON-CHAIN –î–ê–ù–ù–´–ï –ü–û–Ø–í–Ø–¢–°–Ø –ó–î–ï–°–¨ –ü–û–°–õ–ï –ó–ê–í–ï–†–®–ï–ù–ò–Ø –†–ê–£–ù–î–ê"
        }
    };

    let currentLang = 'en';
    let lastUpdateTs = Date.now();
    let timerInterval = null;

    // --- ANIMATION HELPERS ---
    function animateValue(id, end, duration) {
        const obj = document.getElementById(id);
        if (!obj) return;
        const start = parseFloat(obj.innerText.replace(/,/g, '')) || 0;
        if (Math.abs(start - end) < 0.1) { obj.innerText = end.toLocaleString('en-US'); return; }
        
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const val = Math.floor(progress * (end - start) + start);
            obj.innerText = val.toLocaleString('en-US');
            if (progress < 1) window.requestAnimationFrame(step);
            else obj.innerText = end.toLocaleString('en-US');
        };
        window.requestAnimationFrame(step);
    }
    
    function animateFloat(id, end, duration) {
        const obj = document.getElementById(id);
        if (!obj) return;
        obj.innerText = end.toLocaleString('en-US', {maximumFractionDigits:1});
    }

    // --- MAIN LOGIC ---
    function setLang(lang) {
        currentLang = lang;
        document.getElementById('btn-en').className = lang === 'en' ? 'lang-btn active' : 'lang-btn';
        document.getElementById('btn-ru').className = lang === 'ru' ? 'lang-btn active' : 'lang-btn';
        renderContent();
    }

    function renderContent() {
        const c = CONTENT[currentLang];
        document.getElementById('announcement').innerText = c.announcement;
        document.getElementById('h1').innerText = c.h1;
        document.getElementById('subtitle').innerText = c.subtitle;
        document.getElementById('pool-label').innerText = c.pool_label;
        document.getElementById('btn-primary').innerText = c.btn_primary;
        document.getElementById('btn-secondary').innerText = c.btn_secondary;
        document.getElementById('cta-hint').innerText = c.cta_hint;
        
        document.getElementById('steps').innerHTML = c.steps.map(s => `
            <div class="step-card">
                <span class="step-icon">${s.icon}</span>
                <div class="step-text">${s.text}</div>
            </div>`).join('');

        document.getElementById('ref-title').innerText = c.ref_title;
        document.getElementById('ref-sim').innerText = c.ref_sim;
        document.getElementById('ref-btn').innerText = c.ref_btn;

        document.getElementById('slot-badge').innerText = c.slot_available;
        document.getElementById('sponsor-text').innerText = c.sponsor_text;
        document.getElementById('sponsor-cta').innerText = c.sponsor_cta;

        ['jackpot', 'holder', 'treasury', 'dev'].forEach(k => {
            document.getElementById(`lbl-${k}`).innerText = c.stats[k].lbl;
            document.getElementById(`info-${k}`).innerText = c.stats[k].info;
        });

        document.getElementById('history-title').innerText = c.history_title;
        c.th.forEach((t, i) => {
            const ids = ['th-round', 'th-date', 'th-winner', 'th-prize', 'th-proof'];
            document.getElementById(ids[i]).innerText = t;
        });
    }

    async function loadData() {
        try {
            let res = await fetch(API_OVERVIEW);
            if (!res.ok) return;
            let data = await res.json();
            
            if (!data || !data.balances) return;

            lastUpdateTs = Date.now();
            updateLiveStatus();

            animateFloat("prize", data.balances.prize, 1000);
            animateValue("jackpot", data.balances.jackpot, 1000);
            animateValue("holder", data.balances.holder, 1000);
            animateValue("treasury", data.balances.treasury, 1000);
            animateValue("dev", data.balances.dev, 1000);
            
            startTimer(data.round_end_ts);

            let resR = await fetch(API_ROUNDS);
            if (resR.ok) {
                let dataR = await resR.json();
                renderHistory(dataR.rounds);
            }
        } catch(e) { console.error(e); }
    }

    function startTimer(endTs) {
        if (timerInterval) clearInterval(timerInterval);
        const el = document.getElementById('timer');
        updateTimerUI(endTs, el);
        timerInterval = setInterval(() => { updateTimerUI(endTs, el); }, 1000);
    }

    function updateTimerUI(endTs, el) {
        let now = Math.floor(Date.now() / 1000);
        let diff = endTs - now;
        
        const startTs = endTs - ROUND_DURATION;
        let pct = ((now - startTs) / ROUND_DURATION) * 100;
        pct = Math.max(0, Math.min(100, pct));
        document.getElementById('prog-bar').style.width = `${pct}%`;
        document.getElementById('prog-text').innerText = `${CONTENT[currentLang].prog_text}: ${Math.floor(pct)}%`;

        if (diff <= 0) { el.innerText = "00:00:00:00"; return; }
        
        let d = Math.floor(diff / 86400);
        let h = Math.floor((diff % 86400) / 3600);
        let m = Math.floor((diff % 3600) / 60);
        let s = diff % 60;
        
        const pad = n => n.toString().padStart(2, '0');
        el.innerText = `${d}d ${pad(h)}:${pad(m)}:${pad(s)}`;
        
        updateLiveStatus();
    }

    function updateLiveStatus() {
        const el = document.getElementById('updated-ago');
        const diff = Math.floor((Date.now() - lastUpdateTs) / 1000);
        el.innerText = `${CONTENT[currentLang].updated} ${diff}S ${CONTENT[currentLang].ago}`;
    }

    function renderHistory(rounds) {
        const tbody = document.getElementById('history-rows');
        if (!rounds || rounds.length === 0) {
            tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding: 40px; color:#555">${CONTENT[currentLang].empty_history}</td></tr>`;
            return;
        }
        let html = '';
        const fmt = (n) => n ? n.toLocaleString('en-US', {maximumFractionDigits: 1}) : "0";
        rounds.forEach(r => {
            let date = new Date(r.date * 1000).toLocaleDateString();
            html += `<tr>
                <td>#${r.id}</td>
                <td>${date}</td>
                <td>${r.winner}</td>
                <td style="color:var(--main); font-weight:900">${fmt(r.prize)} TON</td>
                <td><a href="https://tonviewer.com/transaction/${r.tx}" target="_blank" class="tx-link">VIEW</a></td>
            </tr>`;
        });
        tbody.innerHTML = html;
    }

    setLang('en');
    loadData();
    setInterval(loadData, 30000);

</script>
</body>
</html>
