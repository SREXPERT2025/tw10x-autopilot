<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TW10X - Decentralized Raffle Protocol</title>
    <style>
        :root { --main: #0098EA; --bg: #050505; --card: #111; --text: #eee; --gray: #666; --green: #00ea88; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 0; line-height: 1.5; }
        a { text-decoration: none; color: inherit; transition: 0.2s; }
        
        /* Announcement Bar */
        .announcement { background: #111; color: var(--green); padding: 8px; text-align: center; font-size: 13px; font-weight: bold; border-bottom: 1px solid #222; letter-spacing: 0.5px; }

        .container { max-width: 800px; margin: 0 auto; padding: 0 20px 40px 20px; }
        
        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; }
        .logo { font-weight: 900; font-size: 24px; letter-spacing: -1px; background: linear-gradient(45deg, #0098EA, #00F0FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-controls { display: flex; gap: 20px; font-size: 14px; font-weight: bold; color: var(--gray); }
        .lang-btn { cursor: pointer; }
        .lang-btn:hover, .active-lang { color: #fff; }
        
        /* Hero */
        .hero { text-align: center; padding: 40px 0; }
        h1 { font-size: 36px; margin: 0 0 15px 0; font-weight: 800; line-height: 1.2; }
        .subtitle { color: var(--gray); font-size: 16px; margin-bottom: 40px; max-width: 500px; margin-left: auto; margin-right: auto; }
        
        /* Prize Card */
        .prize-card { background: linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 100%); border: 1px solid #333; border-radius: 24px; padding: 40px; margin: 0 auto; max-width: 400px; box-shadow: 0 10px 40px rgba(0, 152, 234, 0.1); }
        .prize-label { color: var(--main); text-transform: uppercase; font-size: 12px; font-weight: bold; letter-spacing: 2px; }
        .prize-amount { font-size: 56px; font-weight: 800; margin: 10px 0; line-height: 1; }
        .timer { color: var(--gray); font-variant-numeric: tabular-nums; font-size: 16px; margin-top: 10px; }
        
        .btn-play { display: inline-block; background: var(--main); color: #fff; font-weight: bold; padding: 18px 40px; border-radius: 100px; font-size: 18px; margin-top: 30px; box-shadow: 0 4px 20px rgba(0, 152, 234, 0.4); transform: translateY(0); }
        .btn-play:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(0, 152, 234, 0.6); }

        /* Steps */
        .how-works { display: flex; justify-content: center; gap: 20px; margin-top: 40px; font-size: 13px; color: #888; flex-wrap: wrap; }
        .step span { color: #fff; font-weight: bold; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin-top: 60px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #222; text-align: center; }
        .stat-val { font-size: 20px; font-weight: bold; color: #fff; }
        .stat-lbl { font-size: 12px; font-weight: bold; color: var(--main); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 5px; }
        .stat-desc { font-size: 11px; color: #666; margin-top: 3px; display: block; }
        
        /* Accordion (Learn More) */
        details { margin-top: 10px; }
        summary { cursor: pointer; color: var(--gray); font-size: 11px; list-style: none; text-decoration: underline; }
        summary::-webkit-details-marker { display: none; }
        .details-text { font-size: 11px; color: #888; margin-top: 5px; line-height: 1.4; border-top: 1px solid #222; padding-top: 5px; }

        /* Sponsor Block */
        .sponsor-block { margin-top: 60px; border: 1px dashed #333; border-radius: 16px; padding: 20px; text-align: center; }
        .sponsor-title { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: var(--gray); margin-bottom: 10px; }
        .sponsor-content { font-size: 15px; font-weight: bold; color: #fff; }
        .sponsor-cta { display: inline-block; margin-top: 10px; color: var(--main); font-size: 14px; font-weight: bold; }

        /* History */
        .history-section { margin-top: 80px; }
        h3 { border-bottom: 1px solid #222; padding-bottom: 15px; margin-bottom: 20px; color: var(--gray); font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .history-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .history-table th { text-align: left; color: var(--gray); font-weight: normal; padding: 10px; }
        .history-table td { padding: 15px 10px; border-bottom: 1px solid #1a1a1a; }
        .history-table tr:last-child td { border: none; }
        .tx-link { color: var(--main); opacity: 0.7; }
        .tx-link:hover { opacity: 1; text-decoration: underline; }

        /* Footer */
        footer { margin-top: 80px; border-top: 1px solid #222; padding-top: 40px; text-align: center; color: #444; font-size: 13px; }
        .socials { margin-bottom: 20px; }
        .socials a { margin: 0 10px; color: var(--gray); }
        .socials a:hover { color: #fff; }
    </style>
</head>
<body>

<div class="announcement" id="announcement">
    <!-- JS Injected -->
</div>

<div class="container">
    <header>
        <div class="logo">TW10X</div>
        <div class="header-controls">
            <a href="https://t.me/tw10x" target="_blank">Channel</a>
            <div class="lang-switch">
                <span class="lang-btn" onclick="setLang('en')" id="btn-en">EN</span> | 
                <span class="lang-btn" onclick="setLang('ru')" id="btn-ru">RU</span>
            </div>
        </div>
    </header>

    <div class="hero">
        <h1 id="h1">Decentralized Raffle Protocol</h1>
        <div class="subtitle" id="subtitle">Provably Fair. Powered by Smart Contract.<br>100% On-Chain Transparency.</div>
        
        <div class="prize-card">
            <div class="prize-label" id="pool-label">Current Round Pool</div>
            <div class="prize-amount" id="prize">...</div>
            <div class="timer" id="timer">Loading...</div>
            <a href="https://t.me/tw10x_official_bot" class="btn-play" id="cta">LAUNCH APP üöÄ</a>
        </div>

        <div class="how-works" id="steps">
            <!-- JS Injected -->
        </div>
    </div>

    <!-- Sponsor Block -->
    <div class="sponsor-block">
        <div class="sponsor-title" id="sponsor-title">Round Sponsor</div>
        <div id="sponsor-body">
            <!-- JS Injected -->
        </div>
    </div>

    <div class="stats-grid">
        <!-- Jackpot -->
        <div class="stat-card">
            <div class="stat-val" id="jackpot">-</div>
            <div class="stat-lbl" id="lbl-jackpot">Jackpot</div>
            <span class="stat-desc" id="desc-jackpot">Accumulating Prize</span>
            <details>
                <summary>Learn more</summary>
                <div class="details-text" id="info-jackpot">Accumulates within active rounds. Verified on-chain.</div>
            </details>
        </div>
        <!-- Holder -->
        <div class="stat-card">
            <div class="stat-val" id="holder">-</div>
            <div class="stat-lbl" id="lbl-holder">Holders</div>
            <span class="stat-desc" id="desc-holder">Community Drop</span>
            <details>
                <summary>Learn more</summary>
                <div class="details-text" id="info-holder">Community participation pool. Transparent distribution.</div>
            </details>
        </div>
        <!-- Treasury -->
        <div class="stat-card">
            <div class="stat-val" id="treasury">-</div>
            <div class="stat-lbl" id="lbl-treasury">Treasury</div>
            <span class="stat-desc" id="desc-treasury">Protocol Ops</span>
            <details>
                <summary>Learn more</summary>
                <div class="details-text" id="info-treasury">Protocol operations & growth funding.</div>
            </details>
        </div>
        <!-- Dev -->
        <div class="stat-card">
            <div class="stat-val" id="dev">-</div>
            <div class="stat-lbl" id="lbl-dev">Dev Fund</div>
            <span class="stat-desc" id="desc-dev">Security</span>
            <details>
                <summary>Learn more</summary>
                <div class="details-text" id="info-dev">Maintenance, security audits, and updates.</div>
            </details>
        </div>
    </div>

    <div class="history-section">
        <h3 id="history-title">Recent On-Chain Rounds</h3>
        <table class="history-table">
            <thead>
                <tr>
                    <th id="th-round">Round</th>
                    <th id="th-date">Date</th>
                    <th id="th-winner">Participant</th>
                    <th id="th-prize">Amount</th>
                    <th id="th-proof">Proof</th>
                </tr>
            </thead>
            <tbody id="history-rows">
                <tr><td colspan="5" style="text-align:center; color:#444">Loading on-chain data...</td></tr>
            </tbody>
        </table>
    </div>

    <footer>
        <div class="socials">
            <a href="https://t.me/tw10x_official_bot" target="_blank">Bot</a>
            <a href="https://t.me/tw10x" target="_blank">Channel</a>
            <a href="https://tonviewer.com/EQCOaDls2_jUvqMOVdShynh4tbjZTwczd1Fj0P0PZpBhgYxd" target="_blank">Smart Contract</a>
        </div>
        <p id="slogan">Math-based trust. No backend manipulation.</p>
        <p style="opacity:0.5; font-size:11px; margin-top:20px;">
            TW10X is an experimental protocol. Verify transactions independently.
        </p>
        &copy; 2026 TW10X. Built on TON.
    </footer>
</div>

<script>
    // --- CONFIGURATION ---
    const HAS_SPONSOR = false; // Toggle this manually for now
    const API_OVERVIEW = '/api/public/overview';
    const API_ROUNDS = '/api/public/rounds';

    const CONTENT = {
        en: {
            announcement: "üü¢ Round is live. Participation window is open.",
            h1: "Automated On-Chain<br>Participation Protocol",
            subtitle: "Deterministic rules ‚Ä¢ Smart-contract execution ‚Ä¢ Public verification",
            pool_label: "Current Round Pool",
            cta: "LAUNCH APP üöÄ",
            steps: [
                "1. Join via Telegram Mini App",
                "2. Interaction recorded on-chain",
                "3. Outcome calculated automatically"
            ],
            sponsor_title: "Round Sponsor",
            sponsor_empty: "This round has no external sponsor.<br>Interested in supporting the protocol?",
            sponsor_cta: "Become a Round Sponsor",
            sponsor_filled: "This round is supported by:<br>TON Community DAO", // Example
            stats: {
                jackpot: { lbl: "Jackpot", desc: "Accumulating Prize", info: "Accumulates within active rounds." },
                holder: { lbl: "Holders", desc: "Community Drop", info: "Community participation pool." },
                treasury: { lbl: "Treasury", desc: "Protocol Ops", info: "Protocol operations & growth." },
                dev: { lbl: "Dev Fund", desc: "Security", info: "Maintenance & security updates." }
            },
            history_title: "Recent Rounds",
            th: ["Round", "Date", "Participant", "Amount", "Proof"],
            slogan: "Math-based trust. No backend manipulation."
        },
        ru: {
            announcement: "üü¢ –†–∞—É–Ω–¥ –∞–∫—Ç–∏–≤–µ–Ω. –£—á–∞—Å—Ç–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ.",
            h1: "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π<br>On-Chain –ü—Ä–æ—Ç–æ–∫–æ–ª",
            subtitle: "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ ‚Ä¢ –°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚Ä¢ –ü—É–±–ª–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ—Å—Ç—å",
            pool_label: "–ü—É–ª —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞",
            cta: "–ó–ê–ü–£–°–¢–ò–¢–¨ APP üöÄ",
            steps: [
                "1. –£—á–∞—Å—Ç–∏–µ —á–µ—Ä–µ–∑ Telegram Mini App",
                "2. –í–∫–ª–∞–¥ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è on-chain",
                "3. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
            ],
            sponsor_title: "–°–ø–æ–Ω—Å–æ—Ä —Ä–∞—É–Ω–¥–∞",
            sponsor_empty: "–£ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞ –Ω–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Å–ø–æ–Ω—Å–æ—Ä–∞.<br>–•–æ—Ç–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª?",
            sponsor_cta: "–°—Ç–∞—Ç—å —Å–ø–æ–Ω—Å–æ—Ä–æ–º —Ä–∞—É–Ω–¥–∞",
            sponsor_filled: "–¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω:<br>TON Community DAO",
            stats: {
                jackpot: { lbl: "–î–∂–µ–∫–ø–æ—Ç", desc: "–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –ø—É–ª", info: "–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–æ–Ω–¥ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞." },
                holder: { lbl: "–•–æ–ª–¥–µ—Ä—ã", desc: "–§–æ–Ω–¥ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞", info: "–§–æ–Ω–¥ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤." },
                treasury: { lbl: "–ö–∞–∑–Ω–∞", desc: "–û–ø–µ—Ä–∞—Ü–∏–∏", info: "–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞." },
                dev: { lbl: "Dev Fund", desc: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å", info: "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ–¥–∞." }
            },
            history_title: "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –†–∞—É–Ω–¥—ã",
            th: ["–†–∞—É–Ω–¥", "–î–∞—Ç–∞", "–£—á–∞—Å—Ç–Ω–∏–∫", "–°—É–º–º–∞", "Proof"],
            slogan: "–î–æ–≤–µ—Ä–∏–µ –Ω–∞ –±–∞–∑–µ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏. –ë–µ–∑ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π."
        }
    };

    let currentLang = 'en';
    let timerInterval = null;

    function setLang(lang) {
        currentLang = lang;
        document.getElementById('btn-en').style.color = lang === 'en' ? '#fff' : '#666';
        document.getElementById('btn-ru').style.color = lang === 'ru' ? '#fff' : '#666';
        renderContent();
    }

    function renderContent() {
        const c = CONTENT[currentLang];
        
        // Header & Hero
        document.getElementById('announcement').innerText = c.announcement;
        document.getElementById('h1').innerHTML = c.h1;
        document.getElementById('subtitle').innerText = c.subtitle;
        document.getElementById('pool-label').innerText = c.pool_label;
        document.getElementById('cta').innerText = c.cta;
        
        // Steps
        const stepsHTML = c.steps.map(s => `<div class="step"><span>${s}</span></div>`).join('');
        document.getElementById('steps').innerHTML = stepsHTML;

        // Sponsor
        document.getElementById('sponsor-title').innerText = c.sponsor_title;
        const sBody = document.getElementById('sponsor-body');
        if (HAS_SPONSOR) {
            sBody.innerHTML = `<div class="sponsor-content">${c.sponsor_filled}</div>`;
        } else {
            sBody.innerHTML = `<div class="sponsor-content" style="font-weight:normal; font-size:13px; color:#888">${c.sponsor_empty}</div>
                               <a href="https://t.me/tw10x" target="_blank" class="sponsor-cta">${c.sponsor_cta}</a>`;
        }

        // Stats Labels
        ['jackpot', 'holder', 'treasury', 'dev'].forEach(k => {
            document.getElementById(`lbl-${k}`).innerText = c.stats[k].lbl;
            document.getElementById(`desc-${k}`).innerText = c.stats[k].desc;
            document.getElementById(`info-${k}`).innerText = c.stats[k].info;
        });

        // Table & Footer
        document.getElementById('history-title').innerText = c.history_title;
        document.getElementById('th-round').innerText = c.th[0];
        document.getElementById('th-date').innerText = c.th[1];
        document.getElementById('th-winner').innerText = c.th[2];
        document.getElementById('th-prize').innerText = c.th[3];
        document.getElementById('th-proof').innerText = c.th[4];
        document.getElementById('slogan').innerText = c.slogan;
    }

    // --- DATA & API LOGIC ---
    const fmt = (n) => n ? n.toLocaleString('en-US', {maximumFractionDigits: 1}) : "0";

    async function loadData() {
        try {
            let res = await fetch(API_OVERVIEW);
            if (!res.ok) return;
            let data = await res.json();
            
            if (!data || !data.balances) {
                console.warn("API empty");
                return;
            }
            
            document.getElementById('prize').innerText = fmt(data.balances.prize) + " TON";
            document.getElementById('jackpot').innerText = fmt(data.balances.jackpot);
            document.getElementById('holder').innerText = fmt(data.balances.holder);
            document.getElementById('treasury').innerText = fmt(data.balances.treasury);
            document.getElementById('dev').innerText = fmt(data.balances.dev);
            
            startTimer(data.round_end_ts);

            let resR = await fetch(API_ROUNDS);
            if (resR.ok) {
                let dataR = await resR.json();
                renderHistory(dataR.rounds);
            }
        } catch(e) { console.error(e); }
    }

    function startTimer(endTs) {
        if (timerInterval) clearInterval(timerInterval);
        const el = document.getElementById('timer');
        updateTimerUI(endTs, el);
        timerInterval = setInterval(() => { updateTimerUI(endTs, el); }, 1000);
    }

    function updateTimerUI(endTs, el) {
        let now = Math.floor(Date.now() / 1000);
        let diff = endTs - now;
        if (diff <= 0) {
            el.innerText = "Processing...";
            return;
        }
        let d = Math.floor(diff / 86400);
        let h = Math.floor((diff % 86400) / 3600);
        let m = Math.floor((diff % 3600) / 60);
        let s = diff % 60;
        el.innerText = `Ends in: ${d}d ${h}h ${m}m ${s}s`;
    }

    function renderHistory(rounds) {
        const tbody = document.getElementById('history-rows');
        if (!rounds || rounds.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:#444">...</td></tr>';
            return;
        }
        let html = '';
        rounds.forEach(r => {
            let date = new Date(r.date * 1000).toLocaleDateString();
            html += `<tr>
                <td>#${r.id}</td>
                <td>${date}</td>
                <td>${r.winner}</td>
                <td style="color:var(--main); font-weight:bold">${fmt(r.prize)} TON</td>
                <td><a href="https://tonviewer.com/transaction/${r.tx}" target="_blank" class="tx-link">TX</a></td>
            </tr>`;
        });
        tbody.innerHTML = html;
    }

    // Init
    setLang('en'); // Default
    loadData();
    setInterval(loadData, 30000);

</script>
</body>
</html>
